# Default values for microservice chart
# Override these values in environment-specific values files

name: my-service
namespace: default

replicaCount: 1

image:
  repository: my-service
  tag: latest
  pullPolicy: Always

service:
  type: ClusterIP
  port: 8000

config:
  apiPath: /api/my-service

# Extra secrets to mount (e.g., RSA keys)
extraSecrets: []
# - name: rsa-keys
#   mountPath: /app/keys
#   items:
#     - key: private_key.pem
#       path: private_key.pem

# PostgreSQL configuration using CloudNativePG
postgres:
  enabled: true
  name: postgres-my-service
  instances: 1
  database: mydb
  owner: myuser
  storage:
    size: 5Gi
    storageClass: yc-network-hdd
  postgresql:
    maxConnections: "100"
    sharedBuffers: "256MB"
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  affinity:
    enabled: true

# Prometheus monitoring
prometheus:
  enabled: true
  image:
    repository: prom/prometheus
    tag: v2.48.0
  storage:
    size: 5Gi
    storageClass: yc-network-hdd
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "200m"

# Grafana dashboard
grafana:
  enabled: true
  image:
    repository: grafana/grafana
    tag: 10.2.2
  storage:
    size: 5Gi
    storageClass: yc-network-hdd
  adminPassword: ""  # Set via secret
  serverRootUrl: "%(protocol)s://%(domain)s:%(http_port)s/grafana/"
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"
  ingress:
    enabled: false
    className: nginx
    host: example.com
    path: /grafana
    pathType: Prefix
    tls:
      enabled: false
      secretName: tls-secret
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod

# Ingress configuration
ingress:
  enabled: false
  className: nginx
  host: example.com
  path: /api/my-service
  pathType: ImplementationSpecific
  tls:
    enabled: false
    secretName: tls-secret
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/rewrite-target: /$2

# Network policy
networkPolicy:
  enabled: true

# Pod security context
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

# Container security context
containerSecurityContext:
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL

# Pod anti-affinity for high availability
affinity:
  enabled: true

# Resource limits
resources:
  requests:
    memory: "128Mi"
    cpu: "100m"
  limits:
    memory: "256Mi"
    cpu: "200m"

# Health checks
livenessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 10
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 5
  periodSeconds: 5
